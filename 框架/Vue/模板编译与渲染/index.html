<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"baimohui.github.io",root:"/",images:"/images",scheme:"Muse",version:"8.2.1",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!1,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"搜索...",empty:"没有找到任何搜索结果：${query}",hits_time:"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）",hits:"找到 ${hits} 个搜索结果"}}</script><meta name="description" content="123let vue &#x3D; new Vue(&amp;#123;    render: h &#x3D;&gt; h(App)&amp;#125;).$mount(&amp;#x27;#app&amp;#x27;) vue-cli 配置齐全，大家也都习惯于使用 vue-cli 开发，因此可能会忽略了入口文件中 Vue 实例是怎么去 new 的，以及 #app 元素是怎么渲染到页面的。"><meta property="og:type" content="article"><meta property="og:title" content="Vue 模板编译与渲染"><meta property="og:url" content="https://baimohui.github.io/%E6%A1%86%E6%9E%B6/Vue/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E4%B8%8E%E6%B8%B2%E6%9F%93/index.html"><meta property="og:site_name" content="白抹灰"><meta property="og:description" content="123let vue &#x3D; new Vue(&amp;#123;    render: h &#x3D;&gt; h(App)&amp;#125;).$mount(&amp;#x27;#app&amp;#x27;) vue-cli 配置齐全，大家也都习惯于使用 vue-cli 开发，因此可能会忽略了入口文件中 Vue 实例是怎么去 new 的，以及 #app 元素是怎么渲染到页面的。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/baimohui/FigureBed/img/20211106174430.png"><meta property="article:published_time" content="2021-11-06T08:45:25.897Z"><meta property="article:modified_time" content="2022-02-16T11:27:42.640Z"><meta property="article:author" content="mohui"><meta property="article:tag" content="Vue"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/baimohui/FigureBed/img/20211106174430.png"><link rel="canonical" href="https://baimohui.github.io/%E6%A1%86%E6%9E%B6/Vue/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E4%B8%8E%E6%B8%B2%E6%9F%93/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Vue 模板编译与渲染 | 白抹灰</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">白抹灰</h1><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89Vue-%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">（一）Vue 的初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91"><span class="nav-text">（二）模板编译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#initMixin-%E5%87%BD%E6%95%B0"><span class="nav-text">initMixin 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#compileToFunctions"><span class="nav-text">compileToFunctions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#parse"><span class="nav-text">parse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generate"><span class="nav-text">generate</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="nav-text">（三）模板渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#renderMixin-%E5%87%BD%E6%95%B0"><span class="nav-text">renderMixin 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lifecycleMixin-%E5%87%BD%E6%95%B0"><span class="nav-text">lifecycleMixin 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#patch"><span class="nav-text">patch</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">mohui</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">51</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">50</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button"><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://baimohui.github.io/%E6%A1%86%E6%9E%B6/Vue/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E4%B8%8E%E6%B8%B2%E6%9F%93/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="mohui"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="白抹灰"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Vue 模板编译与渲染</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-06 16:45:25" itemprop="dateCreated datePublished" datetime="2021-11-06T16:45:25+08:00">2021-11-06</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-02-16 19:27:42" itemprop="dateModified" datetime="2022-02-16T19:27:42+08:00">2022-02-16</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span></div><div class="post-meta"><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>13k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vue = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>vue-cli</code> 配置齐全，大家也都习惯于使用 <code>vue-cli</code> 开发，因此可能会忽略了入口文件中 Vue 实例是怎么去 new 的，以及 <code>#app</code> 元素是怎么渲染到页面的。<a id="more"></a></p><h2 id="（一）Vue-的初始化"><a href="#（一）Vue-的初始化" class="headerlink" title="（一）Vue 的初始化"></a>（一）Vue 的初始化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; initMixin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./init&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; lifecycleMixin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./lifecycle&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; renderMixin &#125; = <span class="built_in">require</span>(<span class="string">&quot;./render&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>._init(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">initMixin(Vue)</span><br><span class="line">renderMixin(Vue)</span><br><span class="line">lifecycleMixin(Vue)</span><br></pre></td></tr></table></figure><h2 id="（二）模板编译"><a href="#（二）模板编译" class="headerlink" title="（二）模板编译"></a>（二）模板编译</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vue = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            a: <span class="number">1</span>,</span><br><span class="line">            b: [<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params">h</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;hhh&#x27;</span> &#125;, <span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`&lt;div id=&#x27;hhh&#x27; style=&quot;aa:1;bb:2&quot;&gt;&lt;a&gt;&#123;&#123;xxx&#125;&#125;&#123;&#123;ccc&#125;&#125;&lt;/a&gt;&lt;/div&gt;`</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>上面的代码有 el、template、render 以及 $mount，但毕竟只能渲染一次，那么究竟是谁来负责，或者说谁具备更高的优先级？</p><img src="https://cdn.jsdelivr.net/gh/baimohui/FigureBed/img/20211106174430.png" alt="image-20210821103322082" style="zoom:80%"><p>通过上图，总结如下：</p><ol><li>根据有无 el 属性来决定渲染到哪个根节点上：有的话直接获取 el 根节点，没有的话调用 $mount 去获取根节点；</li><li>根据有无 render 和 template 来决定渲染哪个模板：若 render 函数存在，则优先执行。若不存在，则根据有无 template 来决定。如果有 template，则将其解析成 render 函数所需格式，并使用调用 render 函数渲染；如果没有 template，则将 el 根节点的 <code>outerHTML</code> 作为 template 解析成 render 函数所需格式，并使用调用 render 函数渲染。总之最后都统一使用 render 函数渲染。</li></ol><h3 id="initMixin-函数"><a href="#initMixin-函数" class="headerlink" title="initMixin 函数"></a><code>initMixin</code> 函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// init.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; initState &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./state&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; compileToFunctions &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./compiler/index.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initMixin</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">    Vue.prototype._init = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> vm = <span class="built_in">this</span></span><br><span class="line">        vm.$options = options</span><br><span class="line">        initState(vm)</span><br><span class="line">        <span class="keyword">if</span>(vm.$options.el) &#123;</span><br><span class="line">            vm.$mount(vm.$options.el)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把$mount函数挂在Vue的原型上</span></span><br><span class="line">    <span class="comment">// $mount函数重点在于判断各属性的有无情况，最后返回Vue实例，便于后续访问实例</span></span><br><span class="line">    Vue.prototype.$mount = <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用vm变量获取Vue实例（也就是this）</span></span><br><span class="line">        <span class="keyword">const</span> vm = <span class="built_in">this</span></span><br><span class="line">        <span class="comment">// 获取vm上的$options</span></span><br><span class="line">        <span class="comment">// $options是在_init的时候就绑在vm上了</span></span><br><span class="line">        <span class="keyword">const</span> options = vm.$options</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取传进来的dom</span></span><br><span class="line">        el = <span class="built_in">document</span>.querySelector(el)</span><br><span class="line">        <span class="comment">// el = &#123;&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果options里没有render函数属性</span></span><br><span class="line">        <span class="keyword">if</span> (!options.render) &#123;</span><br><span class="line">            <span class="comment">// 获取options里的template属性</span></span><br><span class="line">            <span class="keyword">let</span> template = options.template</span><br><span class="line">            <span class="comment">// 如果不存在template属性，但能获取到dom</span></span><br><span class="line">            <span class="keyword">if</span> (!template &amp;&amp; el) &#123;</span><br><span class="line">                <span class="comment">// 那就把dom的outerHTML赋值给template属性</span></span><br><span class="line">                template = el.outerHTML</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果存在template属性</span></span><br><span class="line">            <span class="keyword">if</span> (template) &#123;</span><br><span class="line">                <span class="comment">// 将template传入compileToFunctions函数，生成一个render函数</span></span><br><span class="line">                <span class="keyword">const</span> render = compileToFunctions(template)</span><br><span class="line">                <span class="comment">// 把生成的render函数赋值到options的render属性上</span></span><br><span class="line">                options.render = render</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 记得return出Vue实例（也就是this）</span></span><br><span class="line">        <span class="comment">// 为了let vue = new Vue().$mount(&#x27;#a&#x27;)之后，能通过vue变量去访问这个Vue实例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    initMixin: initMixin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="compileToFunctions"><a href="#compileToFunctions" class="headerlink" title="compileToFunctions"></a><code>compileToFunctions</code></h4><p><code>compileToFunctions</code> 函数是模板编译的入口函数，包含 parse 和 generate 的执行，返回值是一个 render 函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler/index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; parse &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./parse.js&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; generate &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./codegen.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compileToFunctions</span> (<span class="params">template</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将template传入parse函数中，生成抽象语法树（AST）</span></span><br><span class="line">    <span class="comment">// 抽象语法树是一个描述dom结构的树结构，包括html，css，js代码</span></span><br><span class="line">    <span class="keyword">let</span> ast = parse(template)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把上面生成的AST传入generate函数中，生成一个render格式的函数代码，格式类似</span></span><br><span class="line">    <span class="comment">// _c(&#x27;div&#x27; &#123;id:&quot;app&quot;&#125;,_c(&#x27;div&#x27;,undefined,_v(&quot;hello&quot;+_s(name)),_c(&#x27;span&#x27;,undefined,_v(&quot;world&quot;))))</span></span><br><span class="line">    <span class="comment">// _c代表创建元素，_v代表创建文本，_s代表文Json.stringify--把对象解析成文本</span></span><br><span class="line">    <span class="keyword">let</span> code = generate(ast)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用with改变this指向，可以方便code里去获取this（也就是Vue实例）里的数据</span></span><br><span class="line">    <span class="keyword">let</span> renderFn = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">`with(this)&#123; return <span class="subst">$&#123;code&#125;</span> &#125;`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回这个生成的render函数</span></span><br><span class="line">    <span class="keyword">return</span> renderFn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    compileToFunctions: compileToFunctions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="parse"><a href="#parse" class="headerlink" title="parse"></a><code>parse</code></h4><p>将 template 转为抽象语法树</p><p>首先需要各种规则匹配的正则表达式（开始标签，结束标签，花括号等）</p><ul><li><code>createASTElement</code>：将某一节点转为 AST 对象的函数</li><li><code>handleStartTag</code>：处理开始标签的函数</li><li><code>handleEndTag</code>：处理结尾标签的函数</li><li><code>handleChars</code>：处理文本节点的函数</li><li><code>parse</code>：转 AST 的入口函数</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ncname = <span class="string">`[a-zA-Z_][\\-\\.0-9_a-zA-Z]*`</span>; </span><br><span class="line"><span class="comment">// 匹配标签名 形如 abc-123</span></span><br><span class="line"><span class="keyword">const</span> qnameCapture = <span class="string">`((?:<span class="subst">$&#123;ncname&#125;</span>\\:)?<span class="subst">$&#123;ncname&#125;</span>)`</span>; </span><br><span class="line"><span class="comment">// 匹配特殊标签 形如 abc:234 前面的abc:可有可无</span></span><br><span class="line"><span class="keyword">const</span> startTagOpen = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`^&lt;<span class="subst">$&#123;qnameCapture&#125;</span>`</span>); </span><br><span class="line"><span class="comment">// 匹配标签开始 形如 &lt;abc-123 捕获里面的标签名</span></span><br><span class="line"><span class="keyword">const</span> startTagClose = <span class="regexp">/^\s*(\/?)&gt;/</span>; </span><br><span class="line"><span class="comment">// 匹配标签结束  &gt;</span></span><br><span class="line"><span class="keyword">const</span> endTag = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`^&lt;\\/<span class="subst">$&#123;qnameCapture&#125;</span>[^&gt;]*&gt;`</span>, <span class="string">&#x27;g&#x27;</span>); </span><br><span class="line"><span class="comment">// 匹配标签结尾 如 &lt;/abc-123&gt; 捕获里面的标签名</span></span><br><span class="line"><span class="keyword">const</span> attribute = <span class="regexp">/^\s*([^\s&quot;&#x27;&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|&#x27;([^&#x27;]*)&#x27;+|([^\s&quot;&#x27;=&lt;&gt;`]+)))?/</span>; </span><br><span class="line"><span class="comment">// 匹配属性  形如 id=&quot;app&quot;</span></span><br><span class="line"><span class="comment">// 全局定义</span></span><br><span class="line"><span class="comment">// root：用来储存根节点</span></span><br><span class="line"><span class="comment">// currentParent：用来储存某个临时的节点</span></span><br><span class="line"><span class="keyword">let</span> root, currentParent</span><br><span class="line"><span class="comment">// 一个临时存节点的数组</span></span><br><span class="line"><span class="keyword">let</span> stack = []</span><br><span class="line"><span class="comment">// 元素节点的type是1</span></span><br><span class="line"><span class="keyword">const</span> ELEMENT_TYPE = <span class="number">1</span></span><br><span class="line"><span class="comment">// 文本节点的type是3</span></span><br><span class="line"><span class="keyword">const</span> TEXT_TYPE = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把某一个节点转换成对应的AST的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createASTElement</span>(<span class="params">tagName, attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        tag: tagName, <span class="comment">// 标签名</span></span><br><span class="line">        type: ELEMENT_TYPE, <span class="comment">// 节点类型</span></span><br><span class="line">        children: [], <span class="comment">// 子节点数组</span></span><br><span class="line">        attrs, <span class="comment">// 属性</span></span><br><span class="line">        parent: <span class="literal">null</span> <span class="comment">// 父节点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleStartTag</span>(<span class="params">&#123; tagName, attrs &#125;</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 传进来的element改成AST对象形式</span></span><br><span class="line">    <span class="keyword">const</span> element = createASTElement(tagName, attrs)</span><br><span class="line">    <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">        <span class="comment">// 根节点只能有一个</span></span><br><span class="line">        root = element</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 临时赋值给currentParent，也就是临时当一回爸爸</span></span><br><span class="line">    currentParent = element</span><br><span class="line">    stack.push(element)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理结尾标签</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleEndTag</span>(<span class="params">tagName</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 父子节点关系对应</span></span><br><span class="line">    <span class="comment">// 比如 &lt;div&gt; &lt;span&gt;&lt;/span&gt; &lt;/div&gt;</span></span><br><span class="line">    <span class="comment">// 那么stack = [&#123; div对象 &#125;, &#123; span对象 &#125;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 那么element就是&#123; span对象 &#125;</span></span><br><span class="line">    <span class="keyword">const</span> element = stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// currentParent是&#123; div对象 &#125;</span></span><br><span class="line">    currentParent = stack[stack.length - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentParent) &#123;</span><br><span class="line">        element.parent = currentParent</span><br><span class="line">        currentParent.children.push(element)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理文本节点的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleChars</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 去除空格</span></span><br><span class="line">    text = text.replace(<span class="regexp">/\s/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (text) &#123;</span><br><span class="line">        currentParent.children.push(&#123;</span><br><span class="line">            type: TEXT_TYPE,</span><br><span class="line">            text</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">html</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 这里的html就是传进来的template字符串</span></span><br><span class="line">    <span class="comment">// 只要html还有长度就继续循环</span></span><br><span class="line">    <span class="keyword">while</span> (html) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取字符&#x27;&lt;&#x27;的位置</span></span><br><span class="line">        <span class="keyword">const</span> textEnd = html.indexOf(<span class="string">&#x27;&lt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果位置是0的话说明遇到开始或者结尾标签了</span></span><br><span class="line">        <span class="comment">// 例如&lt;div&gt;或者&lt;div /&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (textEnd === <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 先使用解析开始标签的函数：parseStartTag进行解析</span></span><br><span class="line">            <span class="keyword">const</span> startTagMatch = parseStartTag()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果解析有返回值，说明是开始标签</span></span><br><span class="line">            <span class="keyword">if</span> (startTagMatch) &#123;</span><br><span class="line">                <span class="comment">// 将解析结果传入，handleStartTag函数：将节点转AST的函数</span></span><br><span class="line">                handleStartTag(startTagMatch)</span><br><span class="line">                <span class="comment">// 跳过本次循环步骤</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果上面的解析没有返回值，则“说明”可能是结尾标签</span></span><br><span class="line">            <span class="comment">// 这里着重说了是“可能”，因为也有可能是文本，例如 “&lt;哈哈哈哈哈哈哈”，这段文本第一个也是&lt;，但它不是开始也不是结尾标签</span></span><br><span class="line">            <span class="comment">// 所以要使用结尾标签的正则判断一下是不是结尾标签</span></span><br><span class="line">            <span class="keyword">const</span> endTagMatch = html.match(endTag)</span><br><span class="line">            <span class="comment">// 如果是结尾标签的话</span></span><br><span class="line">            <span class="keyword">if</span> (endTagMatch) &#123;</span><br><span class="line">                <span class="comment">// 将解析长度传入，advance函数：推进html的函数，具体看下面advance函数的注释</span></span><br><span class="line">                advance(endTagMatch[<span class="number">0</span>].length)</span><br><span class="line">                <span class="comment">// 进行结尾标签的处理</span></span><br><span class="line">                handleEndTag(endTagMatch[<span class="number">1</span>])</span><br><span class="line">                <span class="comment">// 跳过本次循环步骤</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检测文本节点</span></span><br><span class="line">        <span class="keyword">let</span> text</span><br><span class="line">        <span class="keyword">if</span> (textEnd &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 截取这段text</span></span><br><span class="line">            text = html.substring(<span class="number">0</span>, textEnd)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (text) &#123;</span><br><span class="line">            <span class="comment">// 推进html字符串</span></span><br><span class="line">            advance(text.length)</span><br><span class="line">            <span class="comment">// 对文本节点进行处理</span></span><br><span class="line">            handleChars(text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析开始标签的函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parseStartTag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过正则匹配开始标签</span></span><br><span class="line">        <span class="keyword">const</span> start = html.match(startTagOpen)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> match</span><br><span class="line">        <span class="comment">// 如果匹配成功</span></span><br><span class="line">        <span class="keyword">if</span> (start) &#123;</span><br><span class="line">            match = &#123;</span><br><span class="line">                tagName: start[<span class="number">1</span>],</span><br><span class="line">                attrs: []</span><br><span class="line">            &#125;</span><br><span class="line">            advance(start[<span class="number">0</span>].length)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> end, attr</span><br><span class="line">            <span class="comment">// 只要不碰到&gt;，且该标签还有属性，就会一直循环解析</span></span><br><span class="line">            <span class="keyword">while</span> (!(end = html.match(startTagClose)) &amp;&amp;</span><br><span class="line">                   (attr = html.match(attribute))) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 推进html字符串</span></span><br><span class="line">                advance(attr[<span class="number">0</span>].length)</span><br><span class="line">                attr = &#123;</span><br><span class="line">                    name: attr[<span class="number">1</span>],</span><br><span class="line">                    value: attr[<span class="number">3</span>] || attr[<span class="number">4</span>] || attr[<span class="number">5</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                match.attrs.push(attr)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (end) &#123;</span><br><span class="line">                <span class="comment">// 如果匹配到&gt;，说明开始标签解析结束</span></span><br><span class="line">                <span class="comment">// html字符串推进1</span></span><br><span class="line">                advance(<span class="number">1</span>)</span><br><span class="line">                <span class="comment">// 返回解析出来的对象match</span></span><br><span class="line">                <span class="keyword">return</span> match</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 推进html字符串的函数</span></span><br><span class="line">    <span class="comment">// 例如&lt;div&gt;哈哈哈&lt;/div&gt;</span></span><br><span class="line">    <span class="comment">// 匹配到了开始标签&lt;div&gt;，长度是5，那么html字符串就需要推进5，也就是html变成了  哈哈哈&lt;/div&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">advance</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">        html = html.substring(n)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回根节点</span></span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    parse</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="generate"><a href="#generate" class="headerlink" title="generate"></a><code>generate</code></h4><p>将 AST 转换成 render 函数格式的数据</p><p>匹配花括号</p><p>确保 AST 解析成 render 函数所需格式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultTagRE = <span class="regexp">/\&#123;\&#123;((?:.|\r?\n)+?)\&#125;\&#125;/g</span>; <span class="comment">//匹配花括号 &#123;&#123;  &#125;&#125; 捕获花括号里面的内容</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node.type === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 元素节点处理</span></span><br><span class="line">        <span class="keyword">return</span> generate(node)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 文本节点处理</span></span><br><span class="line">        <span class="keyword">const</span> text = node.text</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检测是否有花括号&#123;&#123;&#125;&#125;</span></span><br><span class="line">        <span class="keyword">if</span> (!defaultTagRE.test(text)) &#123;</span><br><span class="line">            <span class="comment">// 没有的话直接返回 _v，创建文本节点</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">`_v(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(text)&#125;</span>)`</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 每次赋值完要重置defaultTagRE.lastIndex</span></span><br><span class="line">        <span class="comment">// 因为正则规则加上全局g的话，lastIndex会逐步递增，具体可以百度查一查正则的全局g情况下的test方法执行后的lastIndex</span></span><br><span class="line">        <span class="keyword">let</span> lastIndex = (defaultTagRE.lastIndex = <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">const</span> tokens = []</span><br><span class="line">        <span class="keyword">let</span> match, index</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((match = defaultTagRE.exec(text))) &#123;</span><br><span class="line">            <span class="comment">// 文本里只要还存在&#123;&#123;&#125;&#125;就会一直正则匹配</span></span><br><span class="line">            index = match.index</span><br><span class="line">            <span class="keyword">if</span> (index &gt; lastIndex) &#123;</span><br><span class="line">                <span class="comment">// 截取&#123;&#123;xxx&#125;&#125;中的文本xxx</span></span><br><span class="line">                tokens.push(<span class="built_in">JSON</span>.stringify(text.slice(lastIndex, index)))</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            tokens.push(<span class="string">`_s(<span class="subst">$&#123;match[<span class="number">1</span>].trim()&#125;</span>)`</span>)</span><br><span class="line">            <span class="comment">// 推进lastIndex</span></span><br><span class="line">            lastIndex = index + match[<span class="number">0</span>].length</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 匹配完&#123;&#123;&#125;&#125;了，但是还有剩余的文本，那就还是push进去</span></span><br><span class="line">        <span class="keyword">if</span> (lastIndex &lt; text.length) &#123;</span><br><span class="line">            tokens.push(<span class="built_in">JSON</span>.stringify(text.slice(lastIndex)))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// return _v函数创建文本节点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`_v(<span class="subst">$&#123;tokens.join(<span class="string">&#x27;+&#x27;</span>)&#125;</span>)`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成render函数格式的code的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> children = getChildren(el)</span><br><span class="line">    <span class="keyword">const</span> code = <span class="string">`_c(&#x27;<span class="subst">$&#123;el.tag&#125;</span>&#x27;,<span class="subst">$&#123;el.attrs.length ? <span class="string">`<span class="subst">$&#123;genProps(el.attrs)&#125;</span>`</span> : <span class="string">&quot;undefined&quot;</span> &#125;</span><span class="subst">$&#123;children ? <span class="string">`,<span class="subst">$&#123;children&#125;</span>`</span> : <span class="string">&quot;&quot;</span>&#125;</span>)`</span>;;</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 处理attrs的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genProps</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attrs.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> attr = attrs[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (attr.name === <span class="string">&#x27;style&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line">            attr.value.split(<span class="string">&#x27;;&#x27;</span>).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> [key, value] = item.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">                obj[key] = value</span><br><span class="line">            &#125;)</span><br><span class="line">            attr.value = obj</span><br><span class="line">        &#125;</span><br><span class="line">        str += <span class="string">`<span class="subst">$&#123;attr.name&#125;</span>:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(attr.value)&#125;</span>,`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&#123;<span class="subst">$&#123;str.slice(<span class="number">0</span>, str.length)&#125;</span>&#125;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取子节点，进行gen的递归</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getChildren</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> children = el.children</span><br><span class="line">    <span class="keyword">if</span> (children &amp;&amp; children.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;children.map(c =&gt; gen(c)).join(<span class="string">&#x27;,&#x27;</span>)&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    generate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="（三）模板渲染"><a href="#（三）模板渲染" class="headerlink" title="（三）模板渲染"></a>（三）模板渲染</h2><p>我们已经把模板转换成了 render 函数所需的格式，那么 Vue 接着会根据如下步骤将其生成真实 DOM 并展示到页面。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$mount --&gt; mountComponent --&gt; _render执行获得虚拟DOM --&gt; _update执行将虚拟DOM转真实DOM并渲染</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染的入口函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span> (<span class="params">vm, el</span>) </span>&#123;</span><br><span class="line">    vm.$el = el;</span><br><span class="line">    <span class="comment">// 将模板编译成render函数渲染所需格式后，需要执行调用_render函数来生成虚拟DOM</span></span><br><span class="line">    <span class="comment">// 接着调用_update函数把虚拟DOM转为真实DOM并渲染</span></span><br><span class="line">    vm._update(vm._render())</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="renderMixin-函数"><a href="#renderMixin-函数" class="headerlink" title="renderMixin 函数"></a><code>renderMixin</code> 函数</h3><p>执行 render 函数，获得虚拟 DOM</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; createElement, createTextNode &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./vdom/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderMixin</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将_render函数挂在Vue原型上</span></span><br><span class="line">    Vue.prototype._render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> vm = <span class="built_in">this</span></span><br><span class="line">        <span class="comment">// 把上一节生成的render函数取出来</span></span><br><span class="line">        <span class="keyword">const</span> &#123; render &#125; = vm.$options</span><br><span class="line">        <span class="comment">// 执行render函数并获得虚拟DOM</span></span><br><span class="line">        <span class="keyword">const</span> vnode = render.call(vm)</span><br><span class="line">        <span class="keyword">return</span> vnode </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建元素节点虚拟DOM</span></span><br><span class="line">    Vue.prototype._c = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createElement(...args)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建文本节点虚拟DOM</span></span><br><span class="line">    Vue.prototype._v = <span class="function"><span class="keyword">function</span> (<span class="params">text</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createTextNode(text)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对象的情况，把对象转成字符串</span></span><br><span class="line">    Vue.prototype._s = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val === <span class="literal">null</span> ? <span class="string">&#x27;&#x27;</span> : <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span> ? <span class="built_in">JSON</span>.stringify(val) : val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    renderMixin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是创建虚拟DOM的具体所需函数以及类</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vdom/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建某一个节点的虚拟DOM</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vnode</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">tag, data, key, children, text</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tag = tag</span><br><span class="line">        <span class="built_in">this</span>.data = data</span><br><span class="line">        <span class="built_in">this</span>.key = key</span><br><span class="line">        <span class="built_in">this</span>.children = children</span><br><span class="line">        <span class="built_in">this</span>.text = text</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建元素节点虚拟DOM</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">tag, data= &#123;&#125;, ...children</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> key = data.key</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Vnode(tag, data, key, children)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建文本节点虚拟DOM</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTextNode</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Vnode(<span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>, text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    createElement,</span><br><span class="line">    createTextNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lifecycleMixin-函数"><a href="#lifecycleMixin-函数" class="headerlink" title="lifecycleMixin 函数"></a><code>lifecycleMixin</code> 函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lifecycle.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; patch &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./vdom/patch&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lifecycleMixin</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 将_update挂在Vue原型上</span></span><br><span class="line">    Vue.prototype._update = <span class="function"><span class="keyword">function</span> (<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> vm = <span class="built_in">this</span></span><br><span class="line">        <span class="comment">// 执行patch函数</span></span><br><span class="line">        vm.$el = patch(vm.$el, vnode) || vm.$el</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mountComponent,</span><br><span class="line">    lifecycleMixin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><p>将虚拟 DOM 转真实 DOM 并渲染）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vdom/patch.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">oldVnode, vnode</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 本节只讲初次渲染</span></span><br><span class="line">    <span class="comment">// 初次渲染时oldVnode就是el节点，以后非初次渲染时，oldVnode就是上一次的虚拟DOM</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断oldVnode的类型</span></span><br><span class="line">    <span class="keyword">const</span> isRealElement = oldVnode.nodeType</span><br><span class="line">    <span class="keyword">if</span> (isRealElement) &#123;</span><br><span class="line">        <span class="comment">// 初次渲染</span></span><br><span class="line">        <span class="keyword">const</span> oldElm = oldVnode</span><br><span class="line">        <span class="keyword">const</span> parentElm = oldElm.parentNode</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成真实DOM对象</span></span><br><span class="line">        <span class="keyword">const</span> el = createElm(vnode)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将生成的真实DOM。插入到el的下一个节点的前面</span></span><br><span class="line">        <span class="comment">// 也就是插到el的后面</span></span><br><span class="line">        <span class="comment">// 不直接appendChild是因为可能页面中有其他el同级节点，不能破坏顺序</span></span><br><span class="line">        parentElm.insertBefore(el, oldElm.nextSibling)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除老el节点</span></span><br><span class="line">        parentElm.removeChild(oldVnode)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> el</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 虚拟DOM生成真实DOM</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElm</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; tag, data, key, children, text &#125; = vnode</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是元素节点还是文本节点</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> tag === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建标签</span></span><br><span class="line">        vnode.el = <span class="built_in">document</span>.createElement(tag)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析虚拟DOM属性</span></span><br><span class="line">        updateProperties(vnode)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 递归，将子节点也生成真实DOM</span></span><br><span class="line">        children.forEach(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> vnode.el.appendChild(createElm(child))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 文本节点直接创建</span></span><br><span class="line">        vnode.el = <span class="built_in">document</span>.createTextNode(text)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vnode.el</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析虚拟DOM的属性</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateProperties</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> newProps = vnode.data || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> el = vnode.el</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> newProps) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;style&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// style的处理</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> styleName <span class="keyword">in</span> newProps.style) &#123;</span><br><span class="line">                el.style[styleName] = newProps.style[styleName]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&#x27;class&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// class的处理</span></span><br><span class="line">            el.className = newProps.class</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 调用dom的setAttribute进行属性设置</span></span><br><span class="line">            el.setAttribute(key, newProps[key])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    patch</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Vue/" rel="tag"># Vue</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E6%A1%86%E6%9E%B6/Vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" rel="prev" title="Vue 响应式原理"><i class="fa fa-chevron-left"></i> Vue 响应式原理</a></div><div class="post-nav-item"><a href="/%E6%B5%8F%E8%A7%88%E5%99%A8/HTTP%20%E8%AF%A6%E8%A7%A3/" rel="next" title="HTTP 详解">HTTP 详解 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){const e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">mohui</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">484k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">7:20</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>